<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Ed Alegrid">
    <title>Node-M2M Â· Demo v1.0</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <!--<script src="../assets/dist/js/bootstrap.bundle.min.js"></script>-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

  </head>
  <body>

<!-- page content -->
<main>
  <h1 class="visually-hidden">Headers examples</h1>

  <div class="container">
    <header class="d-flex flex-wrap justify-content-center py-3 mb-4 border-bottom">
      <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-dark text-decoration-none">
        <span class="fs-5">Node-M2M Web Application Integration Demo</span>
      </a>
    </header>
  </div>
  
  <div class="container">
    <div class="row justify-content-evenly">

    <div class="col-6">
      Basic Remote Control
      <div class="card mt-3" style="width:500px">
        <div class="card-body">
          <h6 class="card-title">Device 100 and 200 Actuator Remote Control</h6>
          <p class="card-text">A quick demo on switching on/off device 100 & 200 actuator.</p>
          <div class="row justify-content-start">
            <div class="col-6">
              <a id="deviceOn" style="width:100px;" class="btn btn-primary" role="button" >ON</a>
              <a id="deviceOff" style="width:100px;" class="btn btn-primary" role="button" >OFF</a>
            </div>
           <div class="col-4 align-self-start">
              <div class="border text-center" id="msg1" style="height:38px;padding:7px;"></div>    
            </div>
          </div>
        </div>
      </div>
      <br>
      <div class="card" style="width:500px">
        <div class="card-body">
          <h6 class="card-title">Device 100 Actuator Remote Control (toggle button)</h6>
          <p class="card-text">Switch on/off device 100 gpio output pin 33.</p>
          <div class="row justify-content-start">
            <div class="col-6">
              <a id="deviceToggle" style="width:200px;" class="btn btn-primary" role="button" >ON/OFF</a>
            </div>
           <div class="col-4 align-self-start">
              <div class="border text-center" id="msg2" style="height:38px;padding:7px;"></div>    
            </div>
          </div>
        </div>
      </div>
      <br>
      <div class="card" style="width:500px">
        <div class="card-body">
          <h6 class="card-title">Device 200 Actuator Remote Control (toggle switch)</h6>
          <p class="card-text">Switch on/off device 200 gpio output pin 33 and 35.</p>
          <div class="row justify-content-start">
            <div class="col-1"></div>
            <div class="col-4">
              <div class="form-check form-switch mb-2">
              <input class="form-check-input" type="checkbox" role="switch" id="device-control1" >
                <label class="form-check-label" for="device-control1"> pin 33</label>
              </div>
              <div class="form-check form-switch mb-2">
              <input class="form-check-input" type="checkbox" role="switch" id="device-control2" checked>
                <label class="form-check-label" for="device-control2"> pin 35</label>
              </div>

            </div>
            <div class="col-4 align-self-start">
              <div class="border text-center" id="msg3" style="height:30px;padding:0px;"></div>
              <div class="border text-center" id="msg4" style="height:30px;padding:0px;"></div>       
            </div>
          </div>
        </div>
      </div>
    
    </div><!-- class="col-6" -->

    <div class="col-6">
      Capturing And Sending Data
      <div class="card mt-3" style="width:500px">
        <div class="card-body">
          <h6 class="card-title">Capture Data from Device 100</h6>
          <p class="card-text">A quick demo on capturing data from a remote device.</p>
          <div class="row justify-content-start">
            <div class="col-6">
              <a id="get-data" style="width:200px;" class="btn btn-primary" role="button" >Capture data</a>
            </div>
           <div class="col-4 align-self-start">
              <div class="border text-center" id="msg5" style="height:38px;padding:7px;"></div>    
            </div>
          </div>
        </div>
      </div>
      <br>
      <div class="card mt-0" style="width:500px">
        <div class="card-body">
          <h6 class="card-title">Send Data to Device 100</h6>
          <p class="card-text">A quick demo on sending data to a remote device.</p>
          <div class="row justify-content-start">
            <div class="col-6">
              <form class="row g-3">
                <div class="col-auto">
                  <label for="input-value" class="visually-hidden">Enter value</label>
                  <input id="input-value" type="text" class="form-control"  placeholder="Enter data">
                </div>
                <div class="col-auto">
                  <button id="send-data" style="width:200px;" type="button" class="btn btn-primary mb-0">Send data</button>
                </div>
              </form>
            </div>
           <div class="col-4 align-self-start">
              <div class="border text-center" id="msg6" style="height:38px;padding:7px;"></div>    
            </div>
          </div>
        </div>
      </div>

    </div><!-- class="col-6" -->

    </div><!-- row -->
  </div><!-- container-->

</main>

  <script>
  
  var remoteDevice = {id:100, pin:33, state:true};
  var device1 = {id:200, pin:33, state:true};
  var device2 = {id:200, pin:35, state:false};  

  if(document.getElementById("deviceOn")){
    document.getElementById("deviceOn").onclick = deviceOn;
  }

  if(document.getElementById("deviceOff")){
    document.getElementById("deviceOff").onclick = deviceOff;
  }

  if(document.getElementById("deviceToggle")){
    document.getElementById("deviceToggle").onclick = deviceToggle;
  }

  document.getElementById("device-control1").addEventListener('click', {
    handleEvent: event => deviceControl(1) 
  });

  document.getElementById("device-control2").addEventListener('click', {
    handleEvent: event => deviceControl(2)
  });

  if(document.getElementById("get-data")){
    document.getElementById("get-data").onclick = getData;
  }

  if(document.getElementById("send-data")){
    document.getElementById("send-data").onclick = sendData;
  }

  // turn off device 200 pin 33 on page loading 
  if(document.getElementById("device-control1")){
    let status = document.getElementById("device-control1").checked;
    console.log('status', status);
    if(status === false){
      msg = "msg3";
      device1 = {id:200, pin:33, state:false};
      setTimeout(() => {
        deviceControl(1);
      }, 100);
    }
  }

  // turn on device 200 pin 35 on page loading 
  if(document.getElementById("device-control2")){
    let status = document.getElementById("device-control2").checked;
    console.log('status', status);
    if(status){
      msg = "msg4";
      device2 = {id:200, pin:35, state:true};
      setTimeout(() => {
        deviceControl(2);
      }, 500);
    }
  }

  function deviceOn(){
    console.log('deviceOn');
    fetch("/device-on", {
      method: 'GET',
    })
    .then(function(response){
      console.log('response:', response);
      return response.json(); 
    })
    .then(function(data){
      console.log('success:', data);
      if(data.error){
        document.getElementById("msg1").innerHTML = data.error;
        return console.log('data.error', data.error);
      }
      document.getElementById("msg1").innerHTML = 'on'; 
    })
    .catch(function(error){
      if(error){ 
        console.log('error:', error);
      }
    })
  }

  function deviceOff(){
    console.log('deviceOff');
    fetch("/device-off", {
      method: 'GET',
    })
    .then(function(response){
      console.log('response:', response);
      return response.json();
    })
    .then(function(data){
      console.log('success:', data);
      if(data.error){
        console.log('data.error', data.error);
        return document.getElementById("msg1").innerHTML = data.error;
      }
      document.getElementById("msg1").innerHTML = 'off'; 
    })
    .catch(function(error){
      if(error){ 
        console.log('error:', error);
      }
    })
  }

  function deviceToggle(){
    console.log('deviceToggle');
    var msg = "msg2";
    fetch("/device-toggle", {
      headers: {'Content-Type':'application/json'},
      method: 'POST',
      body: JSON.stringify(remoteDevice),
    })
    .then(function(response){
      console.log('response:', response);
      return response.json();
    })
    .then(function(data){
      console.log('success:', data);
      if(data.error){
        console.log('data.error', data.error);
        return document.getElementById(msg).innerHTML = data.error;
      }
      if(data.status === true){
        document.getElementById(msg).innerHTML = data.status; // true or on 
        remoteDevice.state = false;
      }
      else{
        document.getElementById(msg).innerHTML = data.status; // false or off
        remoteDevice.state = true;
      }
    })
    .catch(function(error){
      if(error){ 
        console.log('error:', error);
      }
    })
  }

  function deviceControl(sel){
    console.log('deviceControl');
    var msg = null;
    let device = null;
    if(sel === 1){
      device = device1;
      msg = 'msg3';
    }
    if(sel === 2){
      device = device2;
      msg = 'msg4';
    }
    fetch("/device-control", {
      headers: {'Content-Type':'application/json'},
      method: 'POST',
      body: JSON.stringify(device),
    })
    .then(function(response){
      console.log('response:', response);
      return response.json();
    })
    .then(function(data){
      console.log('success:', data);
      if(data.error){
        console.log('data.error', data.error);
        return document.getElementById(msg).innerHTML = data.error;
      }

      if(data.status === true){
        document.getElementById(msg).innerHTML = 'on'; //data.status; 
        device.state = false;
      }
      else{
        document.getElementById(msg).innerHTML = 'off'; //data.status; 
        device.state = true;
      }
    })
    .catch(function(error){
      if(error){ 
        console.log('error:', error);
      }
    })
  }

  function getData(){
    console.log('getData');
    fetch("/get-data", {
      method: 'GET',
    })
    .then(function(response){
      console.log('response:', response);
      return response.json();
    })
    .then(function(data){
      console.log('success:', data);
      if(data.error){
        console.log('data.error', data.error);
        return document.getElementById("msg5").innerHTML = data.error;
      }
      document.getElementById("msg5").innerHTML = data.value; 
    })
    .catch(function(error){
      if(error){ 
        console.log('error:', error);
      }
    })
  }

  function sendData(){
    console.log('sendData');

    var inputValue = null;
    
    if(document.getElementById("input-value")){
      inputValue = document.getElementById("input-value").value;
    }
    console.log('inputValue', inputValue );

    fetch("/send-data", {
      headers: {'Content-Type':'application/json'},
      method: 'POST',
      body: JSON.stringify({value:inputValue}),
    })
    .then(function(response){
      console.log('response:', response);
      return response.json(); 
    })
    .then(function(data){
      console.log('success:', data);
      if(data.error){
        console.log('data.error', data.error);
        return document.getElementById("msg6").innerHTML = data.error;
      }
      document.getElementById("msg6").innerHTML = data.value; 
    })
    .catch(function(error){
      if(error){ 
        console.log('error:', error);
      }
    })
  }

  </script>
  <br>
  <footer class="footer mt-auto py-3 bg-light">
    <div class="container">
      <span class="text-muted">Node-M2M 2021</span>
    </div>
  </footer>

  </body>
</html>
